<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alerta Bairro - Jardim Santo In√°cio</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse-bigger {
      0%,100%{transform:scale(1);opacity:1}
      50%{transform:scale(1.2);opacity:0.7}
    }
    .pulse-bigger { animation: pulse-bigger 1.5s infinite; }
    .text-shadow-sm { text-shadow: 1px 1px 2px rgba(0,0,0,0.2); }
  </style>
</head>

<body class="bg-gray-100 text-gray-800 font-sans">

  <!-- HEADER -->
  <header class="text-center py-16 bg-gray-900 text-white shadow-md">
    <div class="container mx-auto px-6">
      <h1 class="text-4xl md:text-5xl font-extrabold mb-4 tracking-tight text-shadow-sm">
        Alerta Jardim Santo In√°cio
      </h1>
      <p class="text-lg md:text-xl mb-8 opacity-90 font-light">
        Monitoramento comunit√°rio em tempo real ‚Äì Atualiza√ß√µes instant√¢neas.
      </p>
      <a href="https://t.me/AlertaJardimSantoInacio"
         target="_blank"
         class="bg-gray-200 text-gray-900 px-8 py-4 rounded-full font-bold text-lg hover:bg-gray-300 transition-all shadow-md active:scale-95 inline-block">
        Entrar no Canal Oficial
      </a>
    </div>
  </header>

  <!-- CONTE√öDO PRINCIPAL -->
  <main class="container mx-auto px-6 -mt-10">

    <!-- STATUS EM TEMPO REAL -->
    <section id="status-section"
      class="bg-white rounded-3xl p-8 md:p-12 text-center shadow-lg transition-all duration-1000">

      <h2 class="text-sm font-bold text-gray-500 mb-4 uppercase tracking-[0.2em]">
        Situa√ß√£o em Tempo Real
      </h2>

      <div id="status-card"
        class="inline-flex flex-col items-center gap-2 px-10 py-6 rounded-2xl bg-gray-100 transition-all duration-500">

        <div class="flex items-center gap-4">
          <div id="status-indicator"
            class="h-5 w-5 rounded-full bg-gray-500 pulse-bigger"></div>

          <span id="status-text"
            class="font-black text-2xl md:text-4xl tracking-tight text-gray-800">
            Sincronizando...
          </span>
        </div>

        <span id="hora-text"
          class="text-xs font-semibold opacity-50 mt-2"></span>
      </div>

      <p class="mt-6 text-gray-500 text-xs italic">
        Atualiza√ß√£o autom√°tica via Telegram.
      </p>
    </section>

    <!-- CARDS INFORMATIVOS -->
    <section class="py-16 grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="bg-white p-8 rounded-2xl shadow-md border-l-4 border-gray-700 hover:shadow-lg transition-all transform hover:-translate-y-1">
        <div class="text-5xl mb-4">üõ∏</div>
        <h3 class="font-bold text-xl mb-2 text-gray-800">Drones</h3>
        <p class="text-gray-500 text-sm">
          Monitoramento de aeronaves suspeitas sobrevoando a regi√£o.
        </p>
      </div>

      <div class="bg-white p-8 rounded-2xl shadow-md border-l-4 border-red-700 hover:shadow-lg transition-all transform hover:-translate-y-1">
        <div class="text-5xl mb-4">üöî</div>
        <h3 class="font-bold text-xl mb-2 text-red-800">Seguran√ßa</h3>
        <p class="text-gray-500 text-sm">
          Alertas cr√≠ticos e movimenta√ß√£o policial no bairro.
        </p>
      </div>

      <div class="bg-white p-8 rounded-2xl shadow-md border-l-4 border-yellow-700 hover:shadow-lg transition-all transform hover:-translate-y-1">
        <div class="text-5xl mb-4">üõ°Ô∏è</div>
        <h3 class="font-bold text-xl mb-2 text-yellow-800">Utilidade</h3>
        <p class="text-gray-500 text-sm">
          Falta de energia, bloqueios e informa√ß√µes importantes.
        </p>
      </div>
    </section>

    <!-- DIVULGA√á√ÉO DE SERVI√áOS -->
    <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-6">
        <h2 class="text-2xl font-bold mb-4 text-gray-900">
          Divulga√ß√£o de Servi√ßos
        </h2>
        <p class="text-gray-600 mb-8">
          Empresas e profissionais parceiros da comunidade.
        </p>

        <div id="ads-cards"
          class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- An√∫ncios ser√£o carregados dinamicamente -->
        </div>
      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="text-center pb-10 text-gray-500 text-sm">
    &copy; 2026 Alerta Bairro - Jardim Santo In√°cio.
  </footer>

  <!-- ========================= -->
  <!-- SCRIPT STATUS EM TEMPO REAL -->
  <!-- ========================= -->

  <script>
    const evtSource = new EventSource('/api/status-stream');

    evtSource.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const status = data.status;
      const hora = data.hora;

      const statusText = document.getElementById('status-text');
      const horaText = document.getElementById('hora-text');
      const indicator = document.getElementById('status-indicator');
      const card = document.getElementById('status-card');
      const section = document.getElementById('status-section');

      statusText.innerText = status;
      horaText.innerText = `Atualizado √†s ${hora}`;

      const mapStatus = {
        'PAZ':['bg-green-600','bg-gray-100','text-gray-800','#f8fafc'],
        'PERIGO':['bg-red-700','bg-gray-100','text-red-800','#fef2f2'],
        'ALERTA':['bg-red-700','bg-gray-100','text-red-800','#fef2f2'],
        'ARMADOS':['bg-red-700','bg-gray-100','text-red-800','#fef2f2'],
        'MONITORAMENTO':['bg-yellow-600','bg-gray-100','text-gray-800','#fefce8'],
        'M√âDICO':['bg-red-700','bg-gray-100','text-red-800','#fef2f2'],
        'BLOQUEIO':['bg-yellow-700','bg-gray-100','text-gray-800','#fefce8'],
        'SEM LUZ':['bg-yellow-700','bg-gray-100','text-gray-800','#fefce8'],
        'POL√çCIA':['bg-blue-700','bg-gray-100','text-gray-800','#eff6ff']
      };

      let found = false;

      for (const key in mapStatus) {
        if(status.includes(key)){
          const [indClass, cardBg, cardText, sectionBg] = mapStatus[key];
          indicator.className = `h-5 w-5 rounded-full pulse-bigger ${indClass}`;
          card.className = `inline-flex flex-col items-center gap-2 px-10 py-6 rounded-2xl ${cardBg} ${cardText} transition-all`;
          section.style.backgroundColor = sectionBg;
          found = true;
          break;
        }
      }

      if(!found){
        indicator.className='h-5 w-5 rounded-full bg-gray-500 pulse-bigger';
        card.className='inline-flex flex-col items-center gap-2 px-10 py-6 rounded-2xl bg-gray-100 text-gray-800 transition-all';
        section.style.backgroundColor='#ffffff';
      }
    };
  </script>

  <!-- ========================= -->
  <!-- SCRIPT AN√öNCIOS DIN√ÇMICOS -->
  <!-- ========================= -->

  <script>
    const adsContainer = document.getElementById('ads-cards');

    // Carrega ao abrir p√°gina
    fetch('/api/ads')
      .then(res => res.json())
      .then(anuncios => renderAds(anuncios));

    // Atualiza√ß√£o em tempo real
    const evtAds = new EventSource('/api/ads-stream');
    evtAds.onmessage = (event) => {
      const anuncios = JSON.parse(event.data);
      renderAds(anuncios);
    };

    function renderAds(anuncios) {
      adsContainer.innerHTML = '';

      if (!anuncios.length) {
        adsContainer.innerHTML = `
          <div class="col-span-3 text-center text-gray-500">
            Nenhum parceiro cadastrado no momento.
          </div>
        `;
        return;
      }

      anuncios.forEach(ad => {
        adsContainer.innerHTML += `
          <div class="bg-white p-6 rounded-2xl shadow-md hover:shadow-lg transition-all transform hover:-translate-y-1">
            <h3 class="font-bold text-xl mb-2 text-gray-800">${ad.nome}</h3>
            <p class="text-gray-500 text-sm mb-4">${ad.descricao}</p>
            <a href="${ad.link}" target="_blank"
              class="text-blue-700 font-semibold hover:underline">
              Entrar em contato
            </a>
          </div>
        `;
      });
    }
  </script>

</body>
</html>
